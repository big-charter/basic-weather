<!DOCTYPE html>
<html>
  <head>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N"
      crossorigin="anonymous"
    ></script>
    <title>Example</title>
  </head>
  <body>
    <div class="mt-3 text-center">
      <div>
        <form>
          <label for="zip">Zip Code:</label>
          <input type="text" id="zip" name="zip" />
          <button type="submit" id="submit-btn">Submit</button>
        </form>
      </div>
      <div>
        <div id="result" class="mt-3"></div>
      </div>
    </div>
    <script>
      const timestampToDateString = (UNIX_timestamp) => {
        const date = new Date(UNIX_timestamp * 1000);
        const months = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];
        const year = date.getFullYear();
        const month = months[date.getMonth()];
        const day = date.getDate();
        const dateString = month + " " + day + ", " + year;
        return dateString;
      };

      const timestampToTimeString = (UNIX_timestamp) => {
        return new Date(UNIX_timestamp * 1e3).toLocaleTimeString();
      };

      const form = document.querySelector("form");
      const zipInput = document.querySelector("#zip");
      const resultDiv = document.querySelector("#result");

      form.addEventListener("submit", (event) => {
        event.preventDefault();
        const zip = zipInput.value;
        fetch(`/weather?zip=${zip}`)
          .then((response) => response.json())
          .then((data) => {
            const currentDateString = timestampToDateString(data.current.dt);
            const currentTimeString = timestampToTimeString(data.current.dt);
            const sunriseTimeString = timestampToTimeString(
              data.current.sunrise
            );
            const sunsetTimeString = timestampToTimeString(data.current.sunset);
            const currentTemp = Math.round(data.current.temp);

            resultDiv.innerHTML = /*html*/ `
            <p>${currentDateString} ${currentTimeString}</p>
            <p>${sunriseTimeString} Sunrise</p>
            <p>${sunsetTimeString} Sunset</p>
            <p>${currentTemp}&#8457;</p>
            `;
          })
          .catch((error) => {
            console.error(error);
            resultDiv.innerHTML = "An error occurred";
          });
      });
    </script>
  </body>
</html>
